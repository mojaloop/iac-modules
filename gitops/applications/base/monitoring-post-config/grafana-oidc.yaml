apiVersion: grafana.mojaloop.io/v1alpha1
kind: GrafanaOIDC
metadata:
  name: zitadel-grafana-oidc-config
  namespace: ${ARGOCD_ENV_monitoring_namespace}
  annotations:
    argocd.argoproj.io/sync-wave: 5
spec:
  parameters:
    grafanaFqdn: "grafana.${ARGOCD_ENV_grafana_dns_subdomain}"
    zitadelFqdn: "zitadel.${ARGOCD_ENV_zitadel_dns_subdomain}"
    grafanaNamespace: "${ARGOCD_ENV_monitoring_namespace}"
    zitadelAdminHumanUserIdRef:
      name: ${ARGOCD_ENV_zitadel_post_config_output_secret}
      namespace: ${ARGOCD_ENV_zitadel_namespace}
      key: "zitadel_admin_human_user_id"
    adminRbacGroup: "${ARGOCD_ENV_admin_rbac_group}"
    userRbacGroup: "${ARGOCD_ENV_user_rbac_group}"
    oidcProviderGroupClaimPrefix: "${ARGOCD_ENV_zitadel_grant_prefix}"
    organizationIdSecretRef: # TODO: FIX
      name: ${ARGOCD_ENV_zitadel_post_config_init_output_secret}
      namespace: ${ARGOCD_ENV_zitadel_namespace}
      key: zitadel_org_id
  providerConfigsRef:
    zitadelProviderName: "zitadel-provider"
    kubernetesProviderName: "kubernetes-provider"
    grafanaProviderName: "grafana-provider"
