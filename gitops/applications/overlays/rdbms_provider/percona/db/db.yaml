apiVersion: database.mojaloop.io/v1alpha1
kind: SqlPercona
metadata:
  name: "${ARGOCD_ENV_db_name}"
  namespace: "{ARGOCD_ENV_namespace}"
spec:
  parameters:
    dbType: postgres
    dbNamespace: "cc-{ARGOCD_ENV_namespace}"
    secretNamespace: "{ARGOCD_ENV_namespace}"
    postgres:
      crVersion: "2.5.0"
      pgVersion: 16
      image: percona/percona-postgresql-operator:2.5.0-ppg16.4-postgres
      imagePullPolicy: Always
      dbDeployPrefix: "${ARGOCD_ENV_dbdeploy_name_prefix}"
      dbUsername: "${ARGOCD_ENV_db_username}"
      dbSecret: "${ARGOCD_ENV_db_secret}"
      replicas: 1
      storageSize: 10Gi

    pgBackRest:
      backupReponame: repo1
      repo_path: "/pgbackrest"
      image: percona/percona-postgresql-operator:2.5.0-ppg16.4-pgbackrest2.53-1
      storagePort: 443
      backupsRetentionDays: 3
      fullBackupSchedule: "0 0 * * 6"
      diffBackupSchedule: "0 1 * * 1-6"

    pgBouncer:
      image: percona/percona-postgresql-operator:2.5.0-ppg16.4-pgbouncer1.23.1
      replicas: 1
      poolMode: transaction
      queryWaitTimeout: 600
      maxPreparedStatements: 1
      exposeSuperusers: true

  providerConfigsRef:
    scK8sProviderName: sc-kubernetes-provider
    ccK8sProviderName: kubernetes-provider
  managementPolicies:
    - "*"
